# ADR-005 Token Usage Tracking - Grooming Summary

**Date**: 2025-01-21
**File**: `docs/04-Architecture/ADRs/adr-005-token-usage-tracking.md`
**Branch**: file-grooming-07-18

## Summary

Groomed ADR-005 to fix technical inaccuracies and improve clarity while preserving its historical value as an architectural decision record.

## Issues Identified

1. **Inaccurate Reference**: CLAUDE.md incorrectly mentioned token usage stored in a "partitioned `token_usage` table", but the ADR and actual implementation use the `api_requests` table
2. **Missing Index**: The composite index `idx_api_requests_account_time` mentioned in the ADR was never implemented
3. **Broken Links**: GitHub PR link used placeholder URL
4. **Outdated Information**: Specific token limits (140,000) that may change over time
5. **No Cross-Reference**: Missing link to related ADR-023 about the in-memory tokenTracker service

## Changes Made

### 1. Removed Specific Rate Limits

- Changed references from "140,000 token limit per 5-hour window" to generic "rolling time windows"
- This prevents the ADR from becoming outdated as API limits change

### 2. Clarified Decision Language

- Changed "We will implement" to "We decided to implement" to reflect that this is a historical decision

### 3. Added Implementation Status Section

- Added new section documenting deviations from the original design
- Explained that the composite index was not implemented but performance remains acceptable
- Clarified the confusion about `token_usage` table references in early documentation
- Added cross-reference to ADR-023 for the complementary in-memory tokenTracker

### 4. Fixed Links

- Removed broken GitHub PR link
- Added link to ADR-023
- Verified that monitoring.md and api-reference.md links are valid

### 5. Added Context Comments

- Added clarifying comments to SQL examples
- Made Future Enhancements section more tentative ("Consider implementing...")

## Rationale

Following best practices for ADR maintenance:

- **Preserved Historical Context**: Original decision and rationale remain intact
- **Documented Deviations**: Implementation differences are clearly explained
- **Maintained Accuracy**: ADR now accurately reflects both the decision and its implementation
- **Improved Clarity**: Removed outdated specifics that could mislead readers

## Validation

- Consulted with Gemini 2.5 Flash and O3 Mini on the approach
- Both models recommended preserving the original decision while adding an implementation notes section
- Verified all file references and links are valid
- Ensured internal consistency throughout the document

## Impact

This grooming improves the documentation quality without changing any functionality. The ADR now serves its dual purpose:

1. Historical record of the architectural decision
2. Accurate documentation of the current implementation
