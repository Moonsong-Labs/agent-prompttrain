# Claude Usage Monitor Technical Implementation

This document provides technical implementation details for the Claude Usage Monitor integration in the Claude CLI Docker image.

> **Note**: For general usage instructions, see [README.md](./README.md). For architectural decisions, see [ADR-010](../../docs/04-Architecture/ADRs/adr-010-docker-cli-integration.md).

## Monitor-Specific Implementation

### External Dependency

The integration clones and uses the [Claude Code Usage Monitor](https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor) by Maciek-roboblog to provide real-time token usage tracking and predictions.

### Multi-Stage Build Details

```dockerfile
# Builder stage
FROM node:24-alpine as builder
RUN git clone https://github.com/Maciek-roboblog/Claude-Code-Usage-Monitor.git /app/claude-monitor

# Final stage
FROM node:24-alpine
# Python runtime for monitor
RUN apk add --no-cache python3 py3-tz
# Copy monitor from builder
COPY --from=builder --chown=claude:claude /app/claude-monitor /app/claude-monitor
```

### Monitor-Specific Dependencies

- **Python 3**: Required runtime for the monitor script
- **py3-tz**: Alpine package for timezone handling (required by Claude Usage Monitor)

### Wrapper Script Architecture

The monitor has its own wrapper script (`monitor-wrapper.sh`) that:

1. Sources the Claude environment configuration
2. Changes to the monitor directory
3. Executes the Python monitor script with proper context

```bash
cd /app/claude-monitor
exec python3 claude_monitor.py "$@"
```

### Integration Points

The monitor integrates with the Claude CLI ecosystem through:

- Shared credentials directory (`/home/claude/.claude`)
- Reading JSONL usage files generated by Claude CLI
- Unified entrypoint routing (via `entrypoint.sh`)

### Command Aliases

- `monitor` → `/usr/local/bin/claude-monitor`
- `usage` → `/usr/local/bin/ccusage`

These aliases are created during the Docker build for convenience.
